<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="breweries.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="367"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="4826"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="fact_breweries" custom_title="0" dock_id="1" table="4,14:mainfact_breweries"/><dock_state state="000000ff00000000fd00000001000000020000032700000226fc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000000003270000014200ffffff000002ec0000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="04c27445415b464987a59b5d80d3cfe7-0" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="187"/><column index="3" value="98"/><column index="4" value="156"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="86"/><column index="8" value="109"/><column index="9" value="132"/><column index="10" value="124"/><column index="11" value="85"/><column index="12" value="226"/><column index="13" value="78"/><column index="14" value="156"/><column index="15" value="300"/><column index="16" value="156"/><column index="17" value="202"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="70fcd61147c64a168ddc31591fca4431-0" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="187"/><column index="3" value="98"/><column index="4" value="156"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="86"/><column index="8" value="109"/><column index="9" value="132"/><column index="10" value="124"/><column index="11" value="85"/><column index="12" value="226"/><column index="13" value="78"/><column index="14" value="156"/><column index="15" value="300"/><column index="16" value="156"/><column index="17" value="202"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="autocomplete_san_diego_20250615_020731" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="300"/><column index="3" value="98"/><column index="4" value="300"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="78"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="101"/><column index="12" value="93"/><column index="13" value="117"/><column index="14" value="300"/><column index="15" value="85"/><column index="16" value="300"/><column index="17" value="288"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_by_state_20250614_040624" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="163"/><column index="2" value="92"/><column index="3" value="156"/><column index="4" value="93"/><column index="5" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_by_state_20250614_192657" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="163"/><column index="2" value="92"/><column index="3" value="156"/><column index="4" value="300"/><column index="5" value="96"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_by_state_20250614_194248" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="163"/><column index="2" value="92"/><column index="3" value="156"/><column index="4" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_by_type_20250614_194248" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="85"/><column index="2" value="40"/><column index="3" value="156"/><column index="4" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_bycity" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="171"/><column index="3" value="98"/><column index="4" value="202"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="78"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="101"/><column index="12" value="93"/><column index="13" value="117"/><column index="14" value="218"/><column index="15" value="85"/><column index="16" value="202"/><column index="17" value="288"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_bycountry" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="226"/><column index="3" value="98"/><column index="4" value="132"/><column index="5" value="109"/><column index="6" value="66"/><column index="7" value="85"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="93"/><column index="11" value="93"/><column index="12" value="93"/><column index="13" value="109"/><column index="14" value="218"/><column index="15" value="93"/><column index="16" value="132"/><column index="17" value="288"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_bydist" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="226"/><column index="3" value="98"/><column index="4" value="202"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="78"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="101"/><column index="12" value="93"/><column index="13" value="117"/><column index="14" value="265"/><column index="15" value="85"/><column index="16" value="202"/><column index="17" value="288"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_deduped" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="300"/><column index="3" value="132"/><column index="4" value="124"/><column index="5" value="109"/><column index="6" value="98"/><column index="7" value="86"/><column index="8" value="132"/><column index="9" value="124"/><column index="10" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_ids" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="148"/><column index="3" value="98"/><column index="4" value="156"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="85"/><column index="8" value="124"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="101"/><column index="12" value="93"/><column index="13" value="85"/><column index="14" value="249"/><column index="15" value="124"/><column index="16" value="156"/><column index="17" value="280"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_list" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="187"/><column index="3" value="98"/><column index="4" value="171"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="117"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="132"/><column index="12" value="124"/><column index="13" value="85"/><column index="14" value="226"/><column index="15" value="78"/><column index="16" value="171"/><column index="17" value="300"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_postal" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="300"/><column index="3" value="98"/><column index="4" value="117"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="78"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="93"/><column index="12" value="78"/><column index="13" value="101"/><column index="14" value="241"/><column index="15" value="85"/><column index="16" value="117"/><column index="17" value="288"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_san_diego_20250611" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="300"/><column index="3" value="98"/><column index="4" value="179"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="78"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="101"/><column index="12" value="93"/><column index="13" value="101"/><column index="14" value="288"/><column index="15" value="85"/><column index="16" value="179"/><column index="17" value="288"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_search_20250615_020951" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="218"/><column index="3" value="98"/><column index="4" value="218"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="78"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="101"/><column index="12" value="93"/><column index="13" value="85"/><column index="14" value="210"/><column index="15" value="85"/><column index="16" value="218"/><column index="17" value="288"/><column index="18" value="156"/><column index="19" value="296"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_state" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="210"/><column index="3" value="98"/><column index="4" value="202"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="132"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="93"/><column index="12" value="93"/><column index="13" value="85"/><column index="14" value="218"/><column index="15" value="85"/><column index="16" value="202"/><column index="17" value="300"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="breweries_type" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="187"/><column index="3" value="98"/><column index="4" value="171"/><column index="5" value="66"/><column index="6" value="66"/><column index="7" value="117"/><column index="8" value="103"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="132"/><column index="12" value="124"/><column index="13" value="85"/><column index="14" value="226"/><column index="15" value="78"/><column index="16" value="171"/><column index="17" value="300"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="combined_breweries_view" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort><column index="0" mode="0"/></sort><column_widths><column index="1" value="163"/><column index="2" value="96"/><column index="3" value="85"/><column index="4" value="71"/><column index="5" value="93"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="consolidated_breweries" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="300"/><column index="3" value="98"/><column index="4" value="300"/><column index="5" value="109"/><column index="6" value="66"/><column index="7" value="132"/><column index="8" value="124"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="132"/><column index="12" value="124"/><column index="13" value="117"/><column index="14" value="300"/><column index="15" value="124"/><column index="16" value="300"/><column index="17" value="300"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="consolidated_breweriestest" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="300"/><column index="3" value="98"/><column index="4" value="202"/><column index="5" value="109"/><column index="6" value="66"/><column index="7" value="132"/><column index="8" value="124"/><column index="9" value="86"/><column index="10" value="109"/><column index="11" value="132"/><column index="12" value="124"/><column index="13" value="117"/><column index="14" value="288"/><column index="15" value="124"/><column index="16" value="202"/><column index="17" value="300"/><column index="18" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="dim_location" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="70"/><column index="2" value="132"/><column index="3" value="124"/><column index="4" value="109"/><column index="5" value="85"/><column index="6" value="132"/><column index="7" value="124"/><column index="8" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="dim_status" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="60"/><column index="2" value="62"/><column index="3" value="210"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="dim_tipocervejarias" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="50"/><column index="2" value="85"/><column index="3" value="148"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="fact_breweries" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="288"/><column index="2" value="70"/><column index="3" value="50"/><column index="4" value="60"/><column index="5" value="156"/><column index="6" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="korean_breweries_by_state_20250614_015220" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="132"/><column index="2" value="92"/><column index="3" value="156"/><column index="4" value="93"/><column index="5" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="korean_breweries_by_state_20250614_192933" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="132"/><column index="2" value="92"/><column index="3" value="156"/><column index="4" value="300"/><column index="5" value="96"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="korean_breweries_by_type_20250614_015220" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="85"/><column index="2" value="40"/><column index="3" value="156"/><column index="4" value="93"/><column index="5" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="korean_breweries_by_type_20250614_192933" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="85"/><column index="2" value="40"/><column index="3" value="156"/><column index="4" value="300"/><column index="5" value="96"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="micro_states_20250614_194849" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="163"/><column index="2" value="92"/><column index="3" value="85"/><column index="4" value="156"/><column index="5" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="microbreweries_by_type_20250614_015555" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="85"/><column index="2" value="40"/><column index="3" value="56"/><column index="4" value="156"/><column index="5" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="microbreweries_by_type_20250614_042029" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="85"/><column index="2" value="40"/><column index="3" value="56"/><column index="4" value="156"/><column index="5" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="microbreweries_main_metadata_20250614_015555" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="127"/><column index="2" value="156"/><column index="3" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">CREATE TABLE consolidated_breweries AS
SELECT * FROM breweries_bycity
UNION
SELECT * FROM breweries_bycountry
UNION
SELECT * FROM breweries_bydist
UNION
SELECT * FROM breweries_ids
UNION
SELECT * FROM breweries_list
UNION
SELECT * FROM breweries_postal
UNION
SELECT * FROM breweries_san_diego_20250611
UNION
SELECT * FROM breweries_state
UNION
SELECT * FROM breweries_type
UNION
SELECT * FROM autocomplete_san_diego_20250615_020731
UNION
SELECT * FROM breweries_search_20250615_020951;

</sql><sql name="SQL 3*">SELECT * FROM consolidated_breweries;</sql><sql name="SQL 4*">CREATE TABLE &quot;breweries_search_20250615_020951&quot; (
  &quot;id&quot; TEXT,
  &quot;name&quot; TEXT,
  &quot;tipos_cervejaria&quot; TEXT,
  &quot;address_1&quot; TEXT,
  &quot;address_2&quot; TEXT,
  &quot;address_3&quot; TEXT,
  &quot;city&quot; TEXT,
  &quot;estado_provincia&quot; TEXT,
  &quot;codigo_postal&quot; TEXT,
  &quot;country&quot; TEXT,
  &quot;longitude&quot; REAL,
  &quot;latitude&quot; REAL,
  &quot;phone&quot; TEXT,
  &quot;site&quot; TEXT,
  &quot;state&quot; TEXT,
  &quot;street&quot; TEXT,
  &quot;location&quot; TEXT,
  &quot;processed_at&quot; TEXT
);</sql><sql name="SQL 5*">SELECT 
    b.state,
    b.brewery_count AS total_breweries,
    m.brewery_type,
    COUNT(m.brewery_type) AS type_count
FROM 
    breweries_by_state_20250614_194248 AS b
LEFT JOIN 
    micro_states_20250614_194849 AS m ON b.state = m.state
GROUP BY 
    b.state, b.brewery_count, m.brewery_type
ORDER BY 
    b.state, type_count DESC;</sql><sql name="SQL 6*">SELECT 
    k.state,
    k.brewery_count AS total_korean_breweries,
    m.brewery_type,
    COUNT(m.brewery_type) AS microbrewery_count
FROM 
    korean_breweries_by_state_20250614_192933 AS k
LEFT JOIN 
    micro_states_20250614_194849 AS m ON k.state = m.state
WHERE 
    m.brewery_type = 'micro' OR m.brewery_type IS NULL
GROUP BY 
    k.state, k.brewery_count, m.brewery_type
ORDER BY 
    microbrewery_count DESC;</sql><sql name="SQL 7*">-- Encontre os IDs que aparecem mais de uma vez
SELECT id, COUNT(*) as duplicate_count
FROM consolidated_breweries
GROUP BY id
HAVING COUNT(*) &gt; 1
ORDER BY duplicate_count DESC;</sql><sql name="SQL 8*">-- Confirme que não há mais duplicatas
SELECT id, COUNT(*) 
FROM consolidated_breweries
GROUP BY id
HAVING COUNT(*) &gt; 1;
-- Deve retornar 0 linhas</sql><sql name="SQL 9*">
SELECT *
FROM consolidated_breweries;</sql><sql name="SQL 10*"> SELECT 
    l.country,
    l.state,
    t.brewery_type,
    COUNT(*) AS quantity,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (PARTITION BY l.country, l.state), 2) AS percentage
FROM 
     consolidated_breweries f
JOIN 
    dim_location l ON f.city = l.city AND f.estado_provincia = l.state AND f.country = l.country
JOIN 
    dim_tipocervejarias t ON f.tipos_cervejaria = t.brewery_type
GROUP BY 
    l.country, l.state, t.brewery_type
ORDER BY 
    l.country, l.state, quantity DESC;</sql><sql name="SQL 11*">SELECT 
    l.state,
    l.country,
    t.brewery_type,
    COUNT(DISTINCT c.id) AS brewery_count,
    m.brewery_count AS micro_table_count
FROM 
    consolidated_breweries c
JOIN 
    dim_location l ON c.state = l.state AND c.country = l.country
JOIN 
    dim_tipocervejarias t ON c.tipos_cervejaria = t.brewery_type
LEFT JOIN 
    micro_states_20250614_194849 m ON c.state = m.state AND t.brewery_type = m.brewery_type
GROUP BY 
    l.state, l.country, t.brewery_type, m.brewery_count
ORDER BY 
    l.country, l.state;</sql><sql name="SQL 12*">SELECT SUM(brewery_count) AS total_breweries
FROM micro_states_20250614_194849;</sql><sql name="SQL 13*">SELECT 
    l.state,
    l.country,
    t.brewery_type,
    COUNT(DISTINCT c.id) AS brewery_count,
    m.brewery_count AS micro_table_count,
    SUM(m.brewery_count) OVER () AS total_micro_breweries
FROM 
    consolidated_breweries c
JOIN 
    dim_location l ON c.state = l.state AND c.country = l.country
JOIN 
    dim_tipocervejarias t ON c.tipos_cervejaria = t.brewery_type
LEFT JOIN 
    micro_states_20250614_194849 m ON c.state = m.state AND t.brewery_type = m.brewery_type
GROUP BY 
    l.state, l.country, t.brewery_type, m.brewery_count
ORDER BY 
    l.country, l.state;</sql><sql name="SQL 14*">SELECT 
    l.state,
    l.country,
    c.tipos_cervejaria,
    COUNT(DISTINCT c.id) AS brewery_count,
    m.brewery_count AS micro_table_count
FROM 
    consolidated_breweries c
JOIN 
    dim_location l ON c.state = l.state AND c.country = l.country
LEFT JOIN 
    micro_states_20250614_194849 m ON c.state = m.state AND c.tipos_cervejaria = m.brewery_type
GROUP BY 
    l.state, l.country, c.tipos_cervejaria, m.brewery_count
ORDER BY 
    l.country, l.state;</sql><sql name="SQL 15*">SELECT 
    l.state,
    l.country,
    c.tipos_cervejaria,
    COUNT(DISTINCT c.id) AS global_brewery_count,
    k.brewery_count AS korean_brewery_count
FROM 
    consolidated_breweries c
JOIN 
    dim_location l ON c.state = l.state AND c.country = l.country
LEFT JOIN 
    korean_breweries_by_state_20250614_192933 k ON c.state = k.state
WHERE
    l.country = 'South Korea' OR k.state IS NOT NULL
GROUP BY 
    l.state, l.country, c.tipos_cervejaria, k.brewery_count
ORDER BY 
    l.country, l.state;
</sql><sql name="SQL 16*">SELECT 
    COALESCE(l.state, k.state) AS state,
    COALESCE(l.country, 'South Korea') AS country,
    c.tipos_cervejaria,
    COUNT(DISTINCT c.id) AS brewery_count,
    k.brewery_count AS korean_brewery_count
FROM 
    consolidated_breweries c
LEFT JOIN 
    dim_location l ON c.state = l.state AND c.country = l.country
LEFT JOIN 
    korean_breweries_by_state_20250614_192933 k ON c.state = k.state
GROUP BY 
    COALESCE(l.state, k.state),
    COALESCE(l.country, 'South Korea'),
    c.tipos_cervejaria,
    k.brewery_count
ORDER BY 
    COALESCE(l.country, 'South Korea'), 
    COALESCE(l.state, k.state);</sql><sql name="SQL 17*">SELECT 
    l.state,
    l.country,
    c.tipos_cervejaria,
    COUNT(DISTINCT c.id) AS global_brewery_count,
    k.brewery_count AS korean_brewery_count
FROM 
    consolidated_breweries c
JOIN 
    dim_location l ON c.state = l.state AND c.country = l.country
LEFT JOIN 
    korean_breweries_by_state_20250614_192933 k ON c.state = k.state
WHERE
    l.country = 'South Korea' OR k.state IS NOT NULL
GROUP BY 
    l.state, l.country, c.tipos_cervejaria, k.brewery_count
ORDER BY 
    l.country, l.state;</sql><sql name="SQL 18*">SELECT 
    l.state,
    l.country,
    c.tipos_cervejaria,
    COUNT(DISTINCT c.id) AS consolidated_count,
    s.brewery_count AS state_level_count,
    k.brewery_count AS korean_count
FROM 
    consolidated_breweries c
JOIN 
    dim_location l ON c.state = l.state AND c.country = l.country
LEFT JOIN 
    breweries_by_state_20250614_194248 s ON c.state = s.state
LEFT JOIN 
    korean_breweries_by_state_20250614_192933 k ON c.state = k.state
GROUP BY 
    l.state, l.country, c.tipos_cervejaria, s.brewery_count, k.brewery_count
ORDER BY 
    l.country, l.state;
</sql><sql name="SQL 19*">SELECT 
    l.city,
    l.state,
    l.country,
    t.brewery_type,
    COUNT(*) AS brewery_count
FROM 
    consolidated_breweries f
JOIN 
    dim_location l ON f.city = l.city AND f.estado_provincia = l.state AND f.country = l.country
JOIN 
    dim_tipocervejarias t ON f.tipos_cervejaria = t.brewery_type
GROUP BY 
    l.city, l.state, l.country, t.brewery_type
ORDER BY 
    l.country, l.state, l.city, brewery_count DESC;</sql><sql name="SQL 20*">CREATE TABLE fact_breweries AS
SELECT 
    c.id AS brewery_id,
    l.location_id,
    t.type_id,
    s.status_id
FROM consolidated_breweries c
JOIN dim_location l ON c.city = l.city AND c.estado_provincia = l.state
JOIN dim_tipocervejarias t ON c.tipos_cervejaria = t.brewery_type
JOIN dim_status s ON CASE WHEN c.phone = 'N/A' THEN 'Inativo' ELSE 'Ativo' END = s.status;</sql><sql name="SQL 21*">CREATE TABLE fact_breweries AS
SELECT 
    c.id AS brewery_id,
    l.location_id,
    t.type_id,
    s.status_id,
    CURRENT_TIMESTAMP AS created_at, -- Valor padrão
    CURRENT_TIMESTAMP AS updated_at  -- Valor padrão
FROM consolidated_breweries c
JOIN dim_location l ON c.city = l.city AND c.estado_provincia = l.state
JOIN dim_tipocervejarias t ON c.tipos_cervejaria = t.brewery_type
JOIN dim_status s ON CASE WHEN c.phone = 'N/A' THEN 'Inativo' ELSE 'Ativo' END = s.status;</sql><sql name="SQL 22*">SELECT dist from fact_breweries;</sql><sql name="SQL 23*">    -- selecção para ver a view
    SELECT *FROM combined_breweries_view;</sql><sql name="SQL 24*">sELECT 
    COALESCE(l.state, k.state) AS state,
    COALESCE(l.country, 'South Korea') AS country,
    c.tipos_cervejaria,
    COUNT(DISTINCT c.id) AS brewery_count,
    k.brewery_count AS korean_brewery_count
FROM 
    consolidated_breweries c
LEFT JOIN 
    dim_location l ON c.state = l.state AND c.country = l.country
LEFT JOIN 
    korean_breweries_by_state_20250614_192933 k ON c.state = k.state
GROUP BY 
    COALESCE(l.state, k.state),
    COALESCE(l.country, 'South Korea'),
    c.tipos_cervejaria,
    k.brewery_count
ORDER BY 
    COALESCE(l.country, 'South Korea'), 
    COALESCE(l.state, k.state);</sql><current_tab id="19"/></tab_sql></sqlb_project>
